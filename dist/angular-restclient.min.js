!function(){function e(){function e(){}function t(e,t,n,i,o,r,a,s){this.endpointName=e,this.headResponseHeaderPrefix=i,this.endpointConfig=t,this.resource=o(n+this.endpointConfig.route,{},{update:{method:"PUT"},head:{method:"HEAD"}}),this.log=r,this.injector=a,this.q=s}this.endpoints={},this.baseRoute="",this.headResponseHeaderPrefix="",e.prototype.route=function(e){return this.route=e,this},e.prototype.model=function(e){return this.model=e,this},e.prototype.container=function(e){return this.container=e,this},t.$inject=["endpoint","endpointConfig","baseRoute","headResponseHeaderPrefix","$resource","$log","$injector","$q"],t.prototype.get=function(e){var t=this,n=t.q.defer();return this.resource.get(e,function(e){n.resolve(t.mapResult(e))}),n.promise},t.prototype.query=function(e){var t=this,n=t.q.defer();return this.resource.query(e,function(e){n.resolve(t.mapResult(e))}),n.promise},t.prototype.mapResult=function(e){var t=this;t.log.debug("apiFactory ("+t.endpointName+"): Endpoint called");var n=t.endpointConfig.container,i=this.injector.get(t.endpointConfig.model);if(t.log.debug("apiFactory ("+t.endpointName+"): Container set to "+n),angular.isArray(e)||angular.isArray(e[n])){t.log.debug("apiFactory ("+t.endpointName+"): Result is an array");var o=angular.isArray(e)?e:e[n],r=[];angular.forEach(o,function(e){r.push(new i(e))});var a=r}else{t.log.debug("apiFactory ("+t.endpointName+"): Result is NOT an array");var a=new i(e)}return t.log.debug("apiFactory ("+t.endpointName+"): Mapped result is"),t.log.debug(a),a},t.prototype.head=function(e){var t=this;t.log.debug("apiFactory ("+t.endpointName+"): (HEAD) Endpoint called");var n=this.q.defer();return this.resource.head(e,function(e,i){var o=i();if(angular.isDefined(t.headResponseHeaderPrefix)&&"*"!==t.headResponseHeaderPrefix)for(var r in o)0==r.toLowerCase().indexOf(t.headResponseHeaderPrefix.toLowerCase())?o[r.substr(t.headResponseHeaderPrefix.length,r.length)]=o[r]:delete o[r];n.resolve(o)}),n.promise},t.prototype.update=function(e,t){var n=this;t.__method="update",t._clean(),this.log.debug("apiFactory ("+this.endpointName+"): Model to update is"),this.log.debug(t);var i=this.q.defer();return this.resource.update(e,t,function(e){i.resolve(n.mapResult(e))},function(e){i.reject(e)}),i.promise},t.prototype.put=t.prototype.update,t.prototype.save=function(){var e=this;if(angular.isUndefined(arguments[1]))n=arguments[0];else var t=arguments[0],n=arguments[1];var i=this.q.defer();return n.__method="save",n._clean(),this.log.debug("apiFactory ("+this.endpointName+"): Model to save is"),this.log.debug(n),this.resource.save(t,n,function(t){i.resolve(e.mapResult(t))},function(e){i.reject(e)}),i.promise},t.prototype.post=t.prototype.save,this.baseRoute=function(e){this.baseRoute=e},this.headResponseHeaderPrefix=function(e){this.headResponseHeaderPrefix=e},this.endpoint=function(t){var n=new e;return this.endpoints[t]=n,n},this.$get=["$injector",function(e){var n=this,i={};return angular.forEach(n.endpoints,function(o,r){angular.isFunction(o.container)&&(o.container=r),angular.isFunction(n.headResponseHeaderPrefix)&&delete n.headResponseHeaderPrefix,i[r]=e.instantiate(t,{endpoint:r,endpointConfig:o,baseRoute:n.baseRoute,headResponseHeaderPrefix:n.headResponseHeaderPrefix})}),i}],this.$get.$inject=["$injector"]}function t(e,t,n){function i(){this.__foreignData={},this.__annotation={}}return i.prototype.afterLoad=function(){return!0},i.prototype.beforeSave=function(){return!0},i.prototype.init=function(t){this.__foreignData=t,this.__annotation={},e.debug("Model ("+this.constructor.name+"): Original response object is"),e.debug(this.__foreignData);for(var n in this)if(this.hasOwnProperty(n)&&!(["__foreignData","__annotation"].indexOf(n)>-1)&&(angular.isObject(this[n])&&angular.isDefined(this[n].type)&&(this.__annotation[n]=this[n]),!angular.isUndefined(t)))if(angular.isObject(t)&&t.hasOwnProperty(n)){if(this[n]=t[n],angular.isDefined(this.__annotation[n])&&"relation"==this.__annotation[n].type){var i=this.__annotation[n].relation;if(angular.isUndefined(i.foreignField)&&(i.foreignField=n),angular.isUndefined(this.__foreignData[i.foreignField]))continue;if(null===this.__foreignData[i.foreignField]){this[n]=null;continue}"many"==i.type&&this._mapArray(n,this.__foreignData[i.foreignField],i.model),"one"==i.type&&this._mapProperty(n,this.__foreignData[i.foreignField],i.model)}}else this[n]=null;this.afterLoad(),delete this.__foreignData},i.prototype.callBeforeSave=function(e){angular.isArray(e)&&angular.forEach(e,function(e){e._clean()}),angular.isObject(e)&&!angular.isArray(e)&&e._clean()},i.prototype.__reference="id",i.prototype._clean=function(){this.beforeSave();for(var e in this)if(this.hasOwnProperty(e)){if(angular.isDefined(this.__annotation[e])&&angular.isDefined(this.__annotation[e].save)){if(!this.__annotation[e].save){delete this[e];continue}if("reference"==this.__annotation[e].save){this._referenceOnly(this[e]);continue}}if(angular.isDefined(this.__annotation[e])&&angular.isDefined(this.__annotation[e].type)&&"relation"==this.__annotation[e].type&&null!==this[e]){if(!angular.isDefined(this.__annotation[e].relation.type))continue;if("one"==this.__annotation[e].relation.type){this[e]._clean();continue}"many"==this.__annotation[e].relation.type&&angular.forEach(this[e],function(e){e._clean()})}}delete this.__method,delete this.__annotation},i.prototype._mapArray=function(e,n,i){var o=this;if(angular.isUndefined(n)||null==n||0==n.length)return void(o[e]=[]);var r=t.get(i);o[e]=[],angular.forEach(n,function(t){o[e].push(new r(t))})},i.prototype._mapProperty=function(e,n,i){if(angular.isUndefined(n))return void(this[e]=null);var o=t.get(i);this[e]=new o(n)},i.prototype._referenceOnly=function(e){if(angular.isArray(e))angular.forEach(e,function(e){e._referenceOnly(e)});else for(var t in e)e.hasOwnProperty(t)&&t!=e.__reference&&delete e[t]},i.prototype.isValid=function(){for(var e in this)if(this.hasOwnProperty(e)&&angular.isDefined(this.__annotation[e])&&!n[this.__annotation[e].type](this[e]))return!1;return!0},i}function n(){return{string:function(e){return angular.isString(e)},"int":function(e){return angular.isNumber(e)},email:function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)},relation:function(){return!0},"boolean":function(){return!0},date:function(e){return angular.isDate(e)},"float":function(e){return angular.isNumber(e)}}}angular.module("restclient",["ngResource"]).provider("api",e).factory("Model",t).factory("Validator",n),t.$inject=["$log","$injector","Validator"]}();
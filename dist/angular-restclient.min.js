!function(){"use strict";function t(t,e){if(!angular.isDefined(t)&&!angular.isDefined(e))return{};if(!angular.isDefined(t))return e;if(!angular.isDefined(e))return t;if(angular.isDefined(angular.merge))return angular.merge(t,e);var n=t.$$hashKey;if(angular.isObject(e)||angular.isFunction(e)){for(var i=Object.keys(e),r=0,o=i.length;o>r;r++){var a=i[r],s=e[a];angular.isObject(s)?(angular.isObject(t[a])||(t[a]=angular.isArray(s)?[]:{}),this(t[a],s)):t[a]=s}return n?t.$$hashKey=n:delete t.$$hashKey,t}}function e(){}function n(){}function i(e,n){var i=this;this._endpointConfig=e,this._resource=n.get("$resource")(this._endpointConfig.baseRoute+this._endpointConfig.route,{},t({get:{method:"GET",transformResponse:function(t,e,n){return t=angular.fromJson(t),n>=400?t:{result:i._mapResult(angular.fromJson(t)),pagination:i._getPagination(t)}}},save:{method:"POST",transformResponse:function(t,e,n){return t=angular.fromJson(t),n>=400?t:{result:i._mapResult(t)}}},update:{method:"PUT",transformResponse:function(t,e,n){return t=angular.fromJson(t),n>=400?t:{result:i._mapResult(t)}}},head:{method:"HEAD"},remove:{method:"DELETE"}},e.actions)),this._log=n.get("$log"),this._injector=n,this._q=n.get("$q")}function r(t,e){this._endpointConfig=t,this._q=e.get("$q"),this._log=e.get("$log"),this._injector=e,this.mock=e.get(t.mock)}function o(t){this.name=t,this.headResponseHeaderPrefix=null}function a(t,e,n){function i(){this._annotation={}}return i.prototype.reference="id",i.prototype.METHOD_SAVE="save",i.prototype.METHOD_POST="save",i.prototype.METHOD_UPDATE="update",i.prototype.METHOD_PUT="update",i.prototype.clean=function(t,e){var n=this;angular.isDefined(t)||(t=n.METHOD_SAVE,null!==n[n.reference]&&(t=n.METHOD_UPDATE)),angular.isDefined(e)||(e=!1),n._beforeSave(t,e);for(var i in n)if(n.hasOwnProperty(i))if(null!==n[i]){if(angular.isDefined(n._annotation[i])&&angular.isDefined(n._annotation[i].save)){if(!n._annotation[i].save){delete n[i];continue}if(angular.isObject(n._annotation[i].save)&&(t==n.METHOD_POST&&(n._annotation[i].save=n._annotation[i].save.post),t==n.METHOD_PUT&&(n._annotation[i].save=n._annotation[i].save.put)),"reference"==n._annotation[i].save){n._referenceOnly(n[i]);continue}}if(angular.isDefined(n._annotation[i])&&angular.isDefined(n._annotation[i].type)&&"relation"==n._annotation[i].type&&null!==n[i]){if(!angular.isDefined(n._annotation[i].relation.type))continue;if("one"==n._annotation[i].relation.type){n[i].clean(t,!0);continue}"many"==n._annotation[i].relation.type&&angular.forEach(n[i],function(e){e.clean(t,!0)})}}else delete n[i];delete n._annotation},i.prototype._afterLoad=function(t){},i.prototype._beforeSave=function(t,e){},i.prototype._init=function(e){var n=e;this._annotation={},t.debug("Model ("+this.constructor.name+"): Original response object is:",n);for(var i in this)if(this.hasOwnProperty(i)&&!(["_afterLoad","_annotation"].indexOf(i)>-1||(angular.isObject(this[i])&&angular.isDefined(this[i].type)&&(this._annotation[i]=this[i]),angular.isUndefined(e))))if(angular.isObject(e)&&e.hasOwnProperty(i)){if(this[i]=e[i],angular.isDefined(this._annotation[i])&&"relation"==this._annotation[i].type){var r=this._annotation[i].relation;if(angular.isUndefined(r.foreignField)&&(r.foreignField=i),angular.isUndefined(n[r.foreignField]))continue;if(null===n[r.foreignField]){this[i]=null;continue}"many"==r.type&&this._mapArray(i,n[r.foreignField],r.model),"one"==r.type&&this._mapProperty(i,n[r.foreignField],r.model)}}else this[i]=null;this._afterLoad(n)},i.prototype._mapArray=function(t,n,i){var r=this;if(angular.isUndefined(n)||null===n||0===n.length)return void(r[t]=[]);if(null===i)return void angular.forEach(n,function(e){r[t].push(e)});var o=e.get(i);r[t]=[],angular.forEach(n,function(e){r[t].push(new o(e))})},i.prototype._mapProperty=function(t,n,i){if(angular.isUndefined(n))return void(this[t]=null);if(null===i)return void(this[t]=n);var r=e.get(i);this[t]=new r(n)},i.prototype._referenceOnly=function(t){if(angular.isArray(t))angular.forEach(t,function(t){t._referenceOnly(t)});else for(var e in t)t.hasOwnProperty(e)&&e!=t.reference&&delete t[e]},i.prototype.validate=function(t){var e=new n,i=!0,r={};for(var o in this)this.hasOwnProperty(o)&&angular.isDefined(this._annotation[o])&&(angular.isDefined(this._annotation[o].required)&&(this._annotation[o].required&&null===this[o]||this._annotation[o].required&&""===this[o])?(i=!1,r[o]="required"):(angular.isDefined(this._annotation[o].required)||null!==this[o])&&("relation"==this._annotation[o].type&&"one"==this._annotation[o].relation.type?this[o].validate(function(t,e){t||(i=!1,r[o]=e)}):"relation"==this._annotation[o].type&&"many"==this._annotation[o].relation.type?angular.forEach(this[o],function(t,e){t.validate(function(t,n){t||(i=!1,angular.isArray(r[o])||(r[o]=[]),r[o][e]=n)})}):e[this._annotation[o].type](this[o])||(i=!1,r[o]="format_error_"+this._annotation[o].type)));angular.isFunction(t)&&t(i,r)},i.prototype.isValid=function(){var t=!1;return this.validate(function(e){t=e}),t},i}function s(){function t(){this._routeMatcher={}}return t.prototype._routes=function(t){this._routeMatcher={};for(var e in t)t.hasOwnProperty(e)&&(this._routeMatcher[e.match(/\[(GET|POST|PUT|DELETE|PATCH|HEAD)\]/)[1]+(e.match(/:/g)||[]).length]=t[e])},t.prototype.request=function(t,e,n){if(angular.isDefined(e)||(e=[]),angular.isDefined(this._routeMatcher[t+e.length])){var i=t+e.length;return angular.isDefined(n)&&e.push({body:n}),this._routeMatcher[i].apply(this,e)}},t}function u(){function t(){}return t.prototype.string=function(t){return angular.isString(t)},t.prototype["int"]=function(t){return angular.isNumber(t)},t.prototype.email=function(t){var e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)},t.prototype.relation=function(t){return angular.isArray(t)||angular.isObject(t)},t.prototype["boolean"]=function(t){return angular.isDefined(t)&&null!==t&&angular.isDefined(t.constructor)?t.constructor===Boolean:!1},t.prototype.date=function(t){return angular.isDate(t)},t.prototype["float"]=function(t){return angular.isNumber(t)},t}function p(){this._endpoints={},this.baseRoute="",this.headResponseHeaderPrefix="",this.baseRoute=function(t){this.baseRoute=t},this.headResponseHeaderPrefix=function(t){this.headResponseHeaderPrefix=t},this.endpoint=function(t){var e=new o(t);return this._endpoints[t]=e,e},this.$get=["$injector",function(t){var e=this,n={};return angular.forEach(e._endpoints,function(o){angular.isFunction(o.container)&&(o.container=o.name),angular.isFunction(e.headResponseHeaderPrefix)&&delete e.headResponseHeaderPrefix,angular.isFunction(o.baseRoute)&&(o.baseRoute=e.baseRoute),o.headResponseHeaderPrefix=e.headResponseHeaderPrefix,angular.isFunction(o.mock)?n[o.name]=new i(o,t):n[o.name]=new r(o,t)}),n}],this.$get.$inject=["$injector"]}angular.module("restclient",["ngResource"]),e.prototype.get=function(){throw new Error("Not Implemented")},e.prototype.post=function(){throw new Error("Not Implemented")},e.prototype["delete"]=function(){throw new Error("Not Implemented")},e.prototype.put=function(){throw new Error("Not Implemented")},e.prototype.head=function(){throw new Error("Not Implemented")},angular.extend(n.prototype,e.prototype),n.prototype._mapResult=function(t){var e,n=this;n._log.debug("apiFactory ("+n._endpointConfig.name+"): Endpoint called");var i=n._endpointConfig.container,r=this._injector.get(n._endpointConfig.model);if(n._log.debug("apiFactory ("+n._endpointConfig.name+"): Container set to "+i),angular.isArray(t)||angular.isArray(t[i])){n._log.debug("apiFactory ("+n._endpointConfig.name+"): Result is an array");var o=angular.isArray(t)?t:t[i],a=[];angular.forEach(o,function(t){a.push(new r(t))}),e=a}else n._log.debug("apiFactory ("+n._endpointConfig.name+"): Result is NOT an array"),e=new r(t);return n._log.debug("apiFactory ("+n._endpointConfig.name+"): Mapped result is:",e),e},n.prototype._getPagination=function(t){if(angular.isDefined(t.count)&&angular.isDefined(t.limit)&&angular.isDefined(t.skip)&&t.limit>0){t.pagesArray=[];var e=t.count/t.limit;e%1!==0&&(e=Math.ceil(e));var n=parseInt(t.skip/t.limit+1),i=t.limit;t.skip+1+t.limit>t.count&&(i=1==n?t.limit:t.count-(n-1)*t.limit);var r;if(11>e)for(r=1;e>=r;r++)t.pagesArray.push(r);else if(5>=n)for(r=1;11>=r;r++)t.pagesArray.push(r);else if(n>=e-5)for(r=e-11;e>=r;r++)t.pagesArray.push(r);else for(r=n-5;n+5>=r;r++)t.pagesArray.push(r);return{count:t.count,limit:t.limit,skip:t.skip,pagesArray:t.pagesArray,pagesCount:e,currentPage:n,currentPageItemsCount:i}}return null},n.prototype.update=function(){return this.put.apply(this,arguments)},n.prototype.save=function(){return this.post.apply(this,arguments)},n.prototype.remove=function(){return this["delete"].apply(this,arguments)},angular.extend(i.prototype,n.prototype),i.prototype.get=function(e){var n=this,i=n._q.defer();return this._resource.get(e,function(r){r.result.pagination=r.pagination,r.result.endpoint=n,r.result.next=function(){return this.endpoint.get(t(e,{_skip:this.pagination.skip+this.pagination.limit,_limit:this.pagination.limit}))},r.result.previous=function(){return this.endpoint.get(t(e,{_skip:this.pagination.skip-this.pagination.limit,_limit:this.pagination.limit}))},r.result.page=function(n){return this.endpoint.get(t(e,{_skip:n*this.pagination.limit-this.pagination.limit,_limit:this.pagination.limit}))},i.resolve(r.result)},function(t){i.reject(t)}),i.promise},i.prototype.head=function(t){var e=this;e._log.debug("apiFactory ("+e._endpointConfig.name+"): (HEAD) Endpoint called");var n=this._q.defer();return this._resource.head(t,function(t,i){var r=i();if(angular.isDefined(e._endpointConfig.headResponseHeaderPrefix)&&"*"!==e._endpointConfig.headResponseHeaderPrefix)for(var o in r)0===o.toLowerCase().indexOf(e._endpointConfig.headResponseHeaderPrefix.toLowerCase())?r[o.substr(e._endpointConfig.headResponseHeaderPrefix.length,o.length)]=r[o]:delete r[o];n.resolve(r)},function(t){n.reject(t)}),n.promise},i.prototype.put=function(t,e){var n=this._q.defer();if(angular.isArray(e)){var i=angular.copy(e);e=[],angular.forEach(i,function(t){t.clean(),e.push(t)})}else e.clean();return this._log.debug("apiFactory ("+this._endpointConfig.name+"): Model to update is:",e),this._resource.update(t,e,function(t){n.resolve(t.result)},function(t){n.reject(t)}),n.promise},i.prototype.post=function(){var t,e;angular.isUndefined(arguments[1])?t=arguments[0]:(e=arguments[0],t=arguments[1]);var n=this._q.defer();return t.clean(),this._log.debug("apiFactory ("+this._endpointConfig.name+"): Model to save is:",t),this._resource.save(e,t,function(t){n.resolve(t.result)},function(t){n.reject(t)}),n.promise},i.prototype["delete"]=function(t){var e=this._q.defer();if("function"==typeof t._init){var n=t;t={id:n[n.reference]}}return this._log.debug("apiFactory ("+this._endpointConfig.name+"): Model to remove is:",n),this._resource["delete"](t,function(){e.resolve()},function(t){e.reject(t)}),e.promise},angular.extend(r.prototype,n.prototype),r.prototype._extractParams=function(t){for(var e=[],n=/:(\w+)/g,i=n.exec(this._endpointConfig.route);null!==i;)e.push(i[1]),i=n.exec(this._endpointConfig.route);var r=[];return angular.forEach(e,function(e){angular.isObject(t)&&angular.isDefined(t[e])&&r.push(t[e])}),r},r.prototype.get=function(t){var e=this._q.defer(),n=new this.mock,i=n.request("GET",this._extractParams(t)),r=this._mapResult(i);return e.resolve(r),e.promise},r.prototype.post=function(){var t,e,n=new this.mock,i=this._q.defer();angular.isUndefined(arguments[1])?t=arguments[0]:(e=arguments[0],t=arguments[1]),t._method="save",t.clean();var r=n.request("POST",this._extractParams(e),t),o=this._mapResult(r);return i.resolve(o),i.promise},r.prototype.put=function(t,e){var n=new this.mock,i=this._q.defer();if(angular.isArray(e)){var r=angular.copy(e);e=[],angular.forEach(r,function(t){t._method="update",t.clean(),e.push(t)})}else e._method="update",e.clean();var o=n.request("PUT",this._extractParams(t),e),a=this._mapResult(o);return i.resolve(a),i.promise},o.prototype.route=function(t){return this.route=t,this},o.prototype.model=function(t){return this.model=t,this},o.prototype.container=function(t){return this.container=t,this},o.prototype.actions=function(t){return this.actions=t,this},o.prototype.baseRoute=function(t){return this.baseRoute=t,this},o.prototype.mock=function(t){return this.mock=t,this},angular.module("restclient").factory("Model",a),a.$inject=["$log","$injector","Validator"],angular.module("restclient").factory("Mock",s),angular.module("restclient").factory("Validator",u),angular.module("restclient").provider("api",p)}();